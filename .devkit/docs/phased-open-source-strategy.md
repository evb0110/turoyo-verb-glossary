# Phased Open Source Strategy: Clean Migration Path

**Date:** 2025-10-18
**Status:** Recommended approach for your use case

## Timeline & Requirements

### Phase 1: NOW → Few months

- HTML source exists elsewhere (don't need in Git)
- JSON files are parser-generated (can regenerate)
- **Goal:** Open source the code immediately
- **Constraint:** Remove data from Git history completely

### Phase 2: Future (when HTML deprecated)

- JSON files become source of truth
- Need version control for data
- Need collaboration access for team
- **Goal:** Painless migration to private data repo

## Phase 1 Implementation: Clean & Public

### Step 1: Clean Git History (Remove All Data)

Use `git-filter-repo` to completely remove data files from Git history:

```bash
# Install git-filter-repo
brew install git-filter-repo  # macOS
# OR: pip3 install git-filter-repo

# BACKUP FIRST (critical!)
cd ..
cp -r turoyo-verb-glossary turoyo-verb-glossary.backup
cd turoyo-verb-glossary

# Remove data files from entire Git history
git filter-repo --path server/assets/verbs --invert-paths
git filter-repo --path source/Turoyo_all_2024.html --invert-paths
git filter-repo --path .claude --invert-paths
git filter-repo --path .devkit --invert-paths
git filter-repo --path data/segments_v5.json --invert-paths
git filter-repo --path data/verbs_clean_v4.json --invert-paths
git filter-repo --path data/verbs_clean_v4_sample.json --invert-paths
git filter-repo --path data/verbs_final.json --invert-paths
git filter-repo --path data/verbs_final_sample.json --invert-paths
git filter-repo --path data/verbs_final_v5.json --invert-paths

# Verify history is clean
git log --all --oneline --name-only | grep -i "verbs/" || echo "✓ No verb files in history"
git log --all --oneline --name-only | grep -i "source/" || echo "✓ No source files in history"
```

**Alternative: BFG Repo-Cleaner (faster for large histories)**

```bash
# Install BFG
brew install bfg  # macOS

# Remove folders from history
bfg --delete-folders server/assets/verbs
bfg --delete-folders source
bfg --delete-folders .claude
bfg --delete-folders .devkit

# Clean up
git reflog expire --expire=now --all
git gc --prune=now --aggressive
```

### Step 2: Update .gitignore (Prevent Future Commits)

```bash
# Add private data to .gitignore
cat >> .gitignore << 'EOF'

# ==========================================
# PRIVATE DATA (not for version control)
# ==========================================

# Source data (exists elsewhere)
source/

# Generated verb files (regenerated by parser)
server/assets/verbs/

# Claude configuration (personal)
.claude/

# Development/analysis docs (temporary)
.devkit/

# Old/intermediate data files (obsolete)
data/segments_v5.json
data/verbs_clean_v4.json
data/verbs_clean_v4_sample.json
data/verbs_final.json
data/verbs_final_sample.json
data/verbs_final_v5.json
EOF

git add .gitignore
git commit -m "Add private data to .gitignore"
```

### Step 3: Force Push to Origin (Rewrite GitHub History)

```bash
# ⚠️ WARNING: This rewrites history on GitHub
# Make sure you have a backup!

# Add back the remote (git-filter-repo removes it)
git remote add origin https://github.com/evb0110/turoyo-verb-glossary.git

# Force push cleaned history
git push --force origin main

# Verify on GitHub that history is clean
# Check: https://github.com/evb0110/turoyo-verb-glossary/commits/main
```

### Step 4: Make Repository Public

```bash
# On GitHub:
# Settings > Danger Zone > Change repository visibility > Make public
```

### Step 5: Update README.md (Public-Facing)

```markdown
# Turoyo Verb Glossary

Open-source Nuxt 4 application for browsing Turoyo verbs with etymology and conjugations.

## Setup

1. Clone the repository
2. Install dependencies: `pnpm install`
3. Generate verb data: `python3 parser/parse_verbs.py`
4. Run dev server: `pnpm run dev`

Note: Verb data files are generated by the parser and not included in version control.
```

### Step 6: Verify Everything Works

```bash
# Local development (with generated files on disk)
pnpm run dev
curl http://localhost:3456/api/verbs/kətl

# Deploy to Vercel (CLI reads from local disk)
vercel deploy

# Verify deployment works with local data files
```

## Phase 1 Outcome

**What's in Git (public):**

- ✓ All source code (Nuxt app, components, etc.)
- ✓ Parser code (Python scripts)
- ✓ Documentation
- ✗ Verb data files (not in Git)
- ✗ Source HTML (not in Git)
- ✗ .claude config (not in Git)

**What's on local disk:**

- ✓ Everything (code + generated data)
- ✓ Vercel deploys from here

**What's deployed on Vercel:**

- ✓ Code + generated data (from local disk)

## Phase 2 Implementation: Private Data Repo

When HTML is deprecated and JSON becomes source of truth:

### Option A: Git Submodule (Recommended)

```bash
# 1. Create private data repository
mkdir turoyo-verb-data
cd turoyo-verb-data
git init
# Copy server/assets/verbs/*.json here
git add .
git commit -m "Initial verb data"
git remote add origin git@github.com:evb0110/turoyo-verb-data-private.git
git push -u origin main

# 2. In public repo, add as submodule
cd ../turoyo-verb-glossary
git submodule add git@github.com:evb0110/turoyo-verb-data-private.git server/assets/verbs

# 3. Update .gitignore (remove server/assets/verbs/ since it's now a submodule)
# Edit .gitignore and remove the line: server/assets/verbs/

# 4. Commit submodule
git add .gitmodules server/assets/verbs
git commit -m "Add verb data as private submodule"
git push origin main

# 5. Collaborators clone with submodules
git clone --recurse-submodules https://github.com/evb0110/turoyo-verb-glossary.git
# OR if already cloned:
git submodule update --init --recursive
```

**Collaborator access:**

- Grant read access to private `turoyo-verb-data-private` repo
- They can clone public repo + private submodule

**Vercel deployment:**

- Still via CLI from local disk
- Submodule is checked out locally
- No Vercel configuration needed

### Option B: Separate Data Repo (Simpler)

```bash
# 1. Create private data repo (same as above)

# 2. Document in README:
"Data files must be obtained separately from private repository"

# 3. Deployment script:
# scripts/sync-data.sh
#!/bin/bash
# Clone private data repo
git clone git@github.com:evb0110/turoyo-verb-data-private.git /tmp/verb-data
# Copy to local
cp -r /tmp/verb-data/*.json server/assets/verbs/
# Cleanup
rm -rf /tmp/verb-data
```

## Migration Checklist

### Phase 1 (NOW)

- [ ] **BACKUP:** Create full backup of current repo
- [ ] Install `git-filter-repo` or BFG
- [ ] Test history cleaning on backup first
- [ ] Run `git filter-repo` to remove data from history
- [ ] Verify history is clean (no data files in commits)
- [ ] Update `.gitignore` to exclude data files
- [ ] Force push to origin (rewrites GitHub history)
- [ ] Verify on GitHub that data is gone from history
- [ ] Make repository public on GitHub
- [ ] Update README.md for public audience
- [ ] Test local development works (regenerate data)
- [ ] Test Vercel deployment works (CLI with local data)
- [ ] Announce open source release

### Phase 2 (FUTURE)

- [ ] Create private data repository
- [ ] Decide: submodule vs separate repo
- [ ] If submodule: add to public repo
- [ ] If separate: document data access in README
- [ ] Grant collaborator access to private repo
- [ ] Update deployment workflow if needed
- [ ] Test collaborator onboarding flow

## Why This Approach is Best

### For Phase 1

✓ **Simple:** No complex setup, just Git history cleaning
✓ **Clean:** Complete removal of data from history
✓ **Public-ready:** Can open source immediately
✓ **No code changes:** Vercel deployment unchanged
✓ **Flexible:** Easy to add data repo later

### For Phase 2 Migration

✓ **Painless:** Add submodule, done
✓ **Standard:** Submodules are well-understood
✓ **Collaborative:** Easy to grant access
✓ **Vercel-friendly:** Works with CLI deployment

## Important Security Notes

### Before Making Public

1. **Scan for secrets:**

```bash
# Install truffleHog
brew install truffleHog

# Scan entire history
trufflehog git file://. --only-verified
```

2. **Check for sensitive data:**

```bash
# Search history for common secrets
git log --all -p | grep -i "password\|secret\|api_key\|token" || echo "✓ No secrets found"
```

3. **Review environment variables:**

- Ensure `.env` was never committed
- Check `.env.example` doesn't contain real values

### After Making Public

1. **Rotate any credentials** that might have been in history
2. **Monitor GitHub security alerts**
3. **Set up branch protection rules**
4. **Add CONTRIBUTING.md** for external contributors

## Cost Analysis

| Item              | Phase 1 | Phase 2 | Notes                      |
| ----------------- | ------- | ------- | -------------------------- |
| Public repo       | Free    | Free    | GitHub free tier           |
| Private data repo | N/A     | Free    | GitHub free tier (< 100MB) |
| Vercel deployment | Free    | Free    | Hobby tier sufficient      |
| Total             | $0      | $0      | Completely free            |

## Timeline Estimate

**Phase 1 (Open Source Now):**

- History cleaning: 1 hour
- Testing: 1 hour
- Documentation: 1 hour
- **Total: 3 hours**

**Phase 2 (Add Private Data Repo):**

- Create data repo: 30 min
- Add submodule: 30 min
- Testing: 1 hour
- **Total: 2 hours**

## Rollback Plan

If anything goes wrong:

```bash
# Restore from backup
cd ..
rm -rf turoyo-verb-glossary
cp -r turoyo-verb-glossary.backup turoyo-verb-glossary
cd turoyo-verb-glossary

# Force push original history back
git push --force origin main
```

## Next Steps

1. **Review this plan** with your team
2. **Create backup** of current repository
3. **Test on backup** first (create test repo)
4. **Execute Phase 1** when ready
5. **Document for future** Phase 2 transition

## Questions to Consider

Before proceeding:

1. **Licensing:** What open source license? (MIT, Apache, GPL?)
2. **Attribution:** Who should be credited as authors?
3. **Contributing:** Do you want external contributions?
4. **Issues:** Enable GitHub Issues for bug reports?
5. **Discussions:** Enable GitHub Discussions for questions?

## Additional Resources

- [Git Filter-Repo Documentation](https://github.com/newren/git-filter-repo)
- [BFG Repo-Cleaner](https://rtyley.github.io/bfg-repo-cleaner/)
- [GitHub: Making a Private Repo Public](https://docs.github.com/en/repositories/managing-your-repositorys-settings-and-features/managing-repository-settings/setting-repository-visibility)
- [Git Submodules Documentation](https://git-scm.com/book/en/v2/Git-Tools-Submodules)

---

**This is the recommended approach.** It gives you:

1. Clean open source release NOW
2. Painless migration to private data repo LATER
3. No Vercel configuration changes
4. Free and simple throughout

Ready to proceed with Phase 1?
